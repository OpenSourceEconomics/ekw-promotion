%!TEX root = ../main.tex
%-------------------------------------------------------------------------------
\section{Example}\label{Example}
%-------------------------------------------------------------------------------
We now provide an illustration of an EKW model. We start with an outline and discussion of a model of occupational choice by \citet{Keane.1994}. We then discuss its specification, simulation, and calibration using our group's research codes \verb+respy+ and \verb+estimagic+.
%-------------------------------------------------------------------------------
\subsection{Keane \& Wolpin (1994)}
%-------------------------------------------------------------------------------
Individuals live for a total of $T$ periods and choose to either work in one of two occupations ($a_t = 1, 2$), attend school ($a_t = 3$), or stay at home ($a_t = 4$). Immediate rewards are determined as follows:
%
\begin{align*}
r(s_t, a_t) = \begin{cases} w_{1t} =
\exp\{\alpha_{10} + \alpha_{11}g_t + \alpha_{12}e_{1t} + \alpha_{13}e^2_{1t} + \alpha_{14}e_{2t} + \alpha_{15}e^2_{2t} + \epsilon_{1t}\} & \text{if}\; a_t = 1 \\
w_{2t} = \exp\{\alpha_{20} + \alpha_{21}g_t + \alpha_{22}e_{1t} + \alpha_{23}e^2_{1t} + \alpha_{24}e_{2t} + \alpha_{25}e^2_{2t} + \epsilon_{2t}\}& \text{if}\; a_t = 2 \\
\beta_0 - \beta_1 \Ind[\,g_t \geq 12\,] - \beta_2\Ind[\,a_{t - 1} \neq 3\,] + \epsilon_{3t}& \text{if}\; a_t = 3 \\
\gamma_0 + \epsilon_{4t}& \text{if}\; a_t = 4. \\
\end{cases}
\end{align*}
%
$g_t$ is the number of periods of schooling obtained by the beginning of period $t$, $e_{1t}$ and $e_{2t}$ are the number of periods that the individual worked in the two occupations respectively. The reward for each labor market alternative corresponds to its wage $(w_{1t}, w_{2t})$ and $\alpha_{1}$ and $\alpha_{2}$ are thus parameters associated with the wage functions. They capture the returns to schooling and occupation-specific human capital. Turning to the rewards from school attendance, $\beta_0$ is the consumption reward of schooling, $\beta_1$ is the post-secondary cost of schooling, and $\beta_2$ is an adjustment cost associated with returning to school. The mean reward of the home alternative is denoted $\gamma_0$. The $\epsilon_{at}$'s are alternative-specific shocks to occupational productivity, the consumption value of schooling, and home time.\\

\noindent Given the structure of the reward functions and imposing that the shocks are not correlated across choices or time, the state at time $t$ is $s_t = \{g_t,e_{1t},e_{2t},a_{t - 1},\epsilon_{1t},\epsilon_{2t},\epsilon_{3t},\epsilon_{4t}\}$.
%
The current stock of human capital is observable $\{g_t,e_{1t},e_{2t},a_{t - 1}\}$ to the individual and the researcher. It evolves deterministically according to the following rules:
%
\begin{align*}
    e_{1,t+1} &= e_{1t} + \Ind[\,a_t = 1\,] \\
    e_{2,t+1} &= e_{2t} + \Ind[\,a_t = 2\,] \\
    g_{t+1}   &= g_{t\phantom{2}}    +  \Ind[\,a_t = 3\,].
\end{align*}

\noindent The shocks $\{\epsilon_{1t},\epsilon_{2t},\epsilon_{3t},\epsilon_{4t}\}$ are only observable by the individual. They evolve stochastically according to a joint normal distribution  $\mathcal{N}(0, \Sigma)$ with mean zero and covariance matrix $\Sigma$.\\

\noindent \citet{Keane.1994} analyze three different parameterizations of the model and we reproduce the second one for this example. The basic idea is that individuals are about age 16 when entering the model and then follow it for $T = 40$ years until retirement. Initially, individuals are identical and have no labor market experience $(e_{11} = e_{21} = 0)$ but ten years of schooling $(g_1 = 10)$. Different choices over the life cycle are then simply the cumulative effects of different shocks.\\

\noindent Schooling increases wages by only 4\% in the first occupation compared to 8\% in the second. We will thus refer to the former as blue-collar and the latter as white-collar going forward. Starting wages are considerably lower in the white-collar sector, but wages increase more rapidly with occupation-specific experience compared to blue-collar wages. Own-work experience is highly valuable in both occupations. However, while white-collar wages increase with blue-collar experience as well, the opposite is not true. There is a consumption value of schooling of \$5,000, but the total cost of pursuing post-secondary education is considerable and amounts to \$5,000. Once leaving school, individuals incur a nearly prohibitive cost of \$15,000 for re-enrolling. Individuals are forward-looking with a discount factor $\delta$ of 0.95.\\

\noindent We simulate the life cycle histories of 1,000 individuals. Figure \ref{Choices over the life cycle} shows the share of individuals choosing each of the four alternatives by period. Initially, roughly 60\% of individuals enroll in school, but this share declines rapidly, and only 19\% attain any post-secondary education. Right away, about 30\% of individuals are working in the blue-collar occupation.  Blue-collar employment initially increases even further to peak at 65\% as individuals are leaving school and entering the labor market. White-collar employment steadily rises over the life cycle but never reaches more than 40\%. About 5\% of individuals stay at home each period.

\begin{figure}[ht!]\centering
\caption{Choices over the life cycle}\label{Choices over the life cycle}
\scalebox{0.35}{\includegraphics{fig-observed-choices}}
\end{figure}\FloatBarrier

\noindent Overall, the level of average final schooling is slightly above a high school degree with 12.5 years. Individuals choose to incur the immediate costs of their schooling investments in the form of tuition and foregone earnings right at the beginning of their life cycle. Doing so maximizes their ability to reap the reward of increased wages over the remaining time periods.\\

\noindent Figure \ref{Economic mechanism and policy forecast} illustrates the ability of structural microeconometric models to quantify the impact of economic mechanisms and to forecast the effect of public policies. On the left, we vary the discount factor capturing time preferences between $0.945$ and $0.955$ while we reduce $\beta_1$ by the size of a tuition subsidy of up to $\$1,500$ on the right. In both cases, we are interested in the changes to average final schooling.

\begin{figure}[h!]\centering
\caption{Economic mechanism and policy forecast}\label{Economic mechanism and policy forecast}
\subfloat[Time preference]{\scalebox{0.25}{\includegraphics{fig-economic-mechanisms}}}\hspace{0.3cm}
\subfloat[Tuition subsidy]{\scalebox{0.25}{\includegraphics{fig-policy-forecast}}}
\end{figure}\FloatBarrier

\noindent Increases in the discount factor and the tuition subsidy both result in increased levels of average final schooling. However, they do so very different reasons. While individuals put more emphasis on the future benefits of their schooling investment in the former, they react to a reduction in its immediate cost in the latter.
%-------------------------------------------------------------------------------
\subsection{\texttt{respy} and \texttt{estimagic}}
%-------------------------------------------------------------------------------
Our research code \verb+respy+ allows to flexibly specify and simulate EKW models, while the can use our groups optimization toolbox  \verb+estimagic+ for their calibration. We briefly showcase a typical workflow for such an analysis. Instructions on how to use the packages, obtain the source code, assess the testing harness, replicate several seminal papers, and other implementation details are available in their respective online documentations at \url{https://respy.readthedocs.io} and \url{https://estimagic.readthedocs.io}.\\

\noindent Figure \ref{Typical workflow} illustrates a typical workflow. Initially, the user provides the observed data, the parameterization of the model, and other options. All together define the structure of the model, and we can construct the functionality for the evaluation of the likelihood function and the simulation of the data. We can use \verb+estimagic+ for the calibration of the the model and then study the properties of data simulated based on the results.

\begin{figure}[ht!]\centering
\caption{Typical workflow}\label{Typical workflow}
\lstset{language=python, morekeywords={as}, ndkeywords={=}, ndkeywordstyle=\color{blue}, keywordstyle=\color{red}, commentstyle=\color{blue}, emph={}, emphstyle=\color{violet}, basicstyle=\footnotesize, frame=lines,   showlines=true}
\begin{lstlisting}
from estimagic.optimization.optimize import maximize
import respy as rp

# obtain model input
df, params, options = get_model_input()

# process model
crit_func = rp.get_crit_func(params, options, df)
simulate = rp.get_simulate_func(params, options)

# perform likelihood-based calibration and simulate dataset
results, params_rslt = maximize(crit_func, params, "nlopt_bobyqa")
df_rslt = simulate(params_rslt)

# conduct analysis
...

\end{lstlisting}
\end{figure}\FloatBarrier

\noindent Figure \ref{Model specification} shows the model specification files for \citet{Keane.1994}. The file on the left deals with the parameterization of the model. We set the coefficient values for the reward functions and the distribution of the unobservable state variables. On the right, we provide details on the construction of the observed state variables and tuning parameters for numerous numerical methods.

\begin{figure}[h!]\centering
\caption{Model specification}\label{Model specification}
\subfloat[Parameterization]{\scalebox{0.25}{\includegraphics{crop-params}}}\hspace{0.3cm}
\subfloat[Options]{\scalebox{0.25}{\includegraphics{crop-options}}}
\end{figure}\FloatBarrier


\noindent Figure \ref{Dashboard} depicts the online dashboard provided by \verb+estimagic+ to monitor convergence and analyze quality of optimization for individual model parameters.

\begin{figure}[h!]\centering
\caption{Dashboard}\label{Dashboard}
\scalebox{0.50}{\includegraphics{crop-dashboard}}
\end{figure}\FloatBarrier
